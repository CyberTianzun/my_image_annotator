import gradio as gr
from gradio_my_image_annotator import my_image_annotator


example_annotation = {
    # "image": "https://gradio-builds.s3.amazonaws.com/demo-files/base.png",
    "image": "/Users/hiro/online/logic/my_image_annotator/demo/map1_block5_diaoyudi1_front_s.show.png",
    "boxes": [
        {
            "xmin": 405,
            "ymin": 62,
            "xmax": 1056,
            "ymax": 413,
            "label": ["Person"],
            "secondLabel": 'Test2',
            "color": (0, 0, 255),
            "name": "xxx",
            "isLine": True,
            "points": [[959.296875, 855.47265625], [959.296875, 854.48046875], [959.296875, 852.6328125], [959.296875, 850.9765625], [959.296875, 847.25], [959.296875, 844.8671875], [959.296875, 841.71484375], [959.296875, 838.07421875], [959.1015625, 833.49609375], [958.6953125, 828.00390625], [958.203125, 822.19140625], [957.46484375, 816.26953125], [956.453125, 809.8671875], [955.40234375, 803.71875], [954.5859375, 798.5625], [953.7890625, 793.546875], [953.06640625, 789.76953125], [952.1484375, 786.171875], [951.23046875, 782.91796875], [950.53515625, 780.21484375], [949.4921875, 777.3984375], [948.47265625, 774.90234375], [947.63671875, 772.4296875], [946.87890625, 770.5078125], [946.18359375, 769.109375], [945.5, 767.7421875], [944.84375, 766.5859375], [944.38671875, 765.828125], [944.15234375, 765.26953125], [943.7734375, 764.38671875], [943.20703125, 763.03125], [942.61328125, 761.81640625], [942.11328125, 761.16015625], [941.51171875, 760.40234375], [940.98828125, 759.51171875], [940.61328125, 758.86328125], [940.04296875, 758.0703125], [939.24609375, 757.09375], [938.5546875, 756.09375], [937.890625, 755.2578125], [936.9453125, 754.71484375], [936.171875, 754.23828125], [935.71875, 753.8125], [934.81640625, 753.10546875], [933.0625, 751.734375], [930.77734375, 750.078125], [928.98828125, 748.71484375], [928.00390625, 747.88671875], [926.609375, 747.015625], [923.11328125, 744.40234375], [921.95703125, 743.5234375], [920.65234375, 742.5625], [919.4140625, 741.6640625], [918.37890625, 740.953125], [917.34375, 740.25], [916.48828125, 739.59765625], [915.66796875, 739.09375], [914.72265625, 738.58984375], [913.91796875, 738.109375], [913.14453125, 737.78125], [912.19921875, 737.4453125], [911.22265625, 737.109375], [910.4375, 736.80078125], [909.8046875, 736.49609375], [909.1875, 736.19140625], [908.765625, 736.04296875], [908.34375, 735.89453125], [908.046875, 735.6171875], [907.7578125, 735.34375], [907.18359375, 735.19921875], [906.42578125, 734.8828125], [905.484375, 734.41015625], [904.73046875, 734.15625], [904.1171875, 733.8046875], [903.33984375, 733.37890625], [902.57421875, 733.046875], [901.94140625, 732.73046875], [901.328125, 732.546875], [900.80078125, 732.36328125], [900.48046875, 732.2109375], [900.21875, 732.078125], [899.921875, 731.9453125], [899.67578125, 731.9453125], [899.2890625, 731.80859375], [898.546875, 731.515625], [897.5859375, 731.19140625], [896.41015625, 730.8515625], [895.25, 730.67578125], [894.09375, 730.33203125], [893.125, 729.98828125], [892.3671875, 729.828125], [891.73046875, 729.5859375], [891.30078125, 729.47265625], [890.86328125, 729.421875], [890.53515625, 729.39453125], [890.21484375, 729.3828125], [889.9140625, 729.375], [889.64453125, 729.37109375]],
        },
        {
            "xmin":2594,
            "ymin":1343,
            "xmax":3238,
            "ymax":1875,
            "label": ["Person"],
            "secondLabel": 'Test',
            "color": (0, 255, 0),
            "name": "222",
            "isLine": True,
            "points": [[3237,1874], [2595,1358]],
        },
        
    ]
}

def get_boxes_json(annotations):
    return annotations["boxes"]


with gr.Blocks() as demo:
    with gr.Tab("Object annotation", id="tab_object_annotation"):
        annotator = my_image_annotator(
            example_annotation,
            label_list=["Person", "Vehicle"],
            second_label_list=["Test", "Test2"],
            label_colors=[(0, 255, 0), (255, 0, 0)],
        )
        button_get = gr.Button("Get bounding boxes")
        json_boxes = gr.JSON()
        button_get.click(get_boxes_json, annotator, json_boxes)


if __name__ == "__main__":
    demo.launch()